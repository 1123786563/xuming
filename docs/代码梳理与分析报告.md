# 续命 (XuMing) 项目分析报告

通过对现有代码库的深度梳理，以下是关于功能实现现状、缺失功能以及优化建议的分析。

## 1. 功能实现现状评估

目前项目在 **UI/UX 表现层** 完成度极高，但在 **业务逻辑深层** 和 **数据持久化** 方面仍处于早期阶段。

### ✅ 已完成（表现层为主）
- **视觉风格**：成功构建了强烈的赛博朋克/BIOS 风格，使用了霓虹色调、扫描线效果、故障文字和像素化 UI。
- **页面架构**：核心页面均已创建，路由配置完整（`app_router.dart` 已定义 20+ 个路由）。
- **页面交互**：开屏动画、诊断流程、仪表盘显示、动作执行计时、商店列表、BOSS 模式伪装等 UI 交互逻辑已通。

### 🟡 半完成（逻辑层 mock）
- **状态管理**：使用 Riverpod 管理 HP、金币等状态，但仅存在于内存中，重启即失。
- **久坐监测**：通过 `Timer` 模拟 HP 线性扣减，尚未与真实传感器或后台服务挂钩。
- **商店系统**：支持金币扣减逻辑，但缺乏更完整的库存管理和解锁反馈 UI。

---

## 2. 待实现功能（Gap Analysis）

基于 `开发计划表.md` 和 `完整的业务与交互链路.md`，以下核心逻辑尚未实现：

### 🚨 关键逻辑缺失
1.  **数据持久化 (Persistence)**：虽然 `pubspec.yaml` 引入了 `Isar`，但尚未在 `UserStateNotifier` 中集成。用户辛苦积攒的金币和恢复的 HP 无法保存。
2.  **真实久坐算法**：目前的“后台监控”只是一个简单的定时器。需要利用 `sensors_plus` 识别用户是真正静止还是在活动。
3.  **后台保活服务**：移动端应用退出后台后，`Timer` 可能停止。需要探索真正的 Background Service（如 `flutter_background_service`）或集成系统级提醒。
4.  **成就/统计详情**：`StatisticsPage` 虽然存在路由，但深度数据统计逻辑（如周报生成、HP 变化曲线）尚未实现。

### 🛠 细节待补
1.  **商店购买反馈**：余额不足、购买成功后的动效与弹窗提示（目前有 TODO）。
2.  **资产真实化**：部分 3D 模型区域目前使用 `Icon` 替代，建议引入 Rive 动画或真正的 3D 渲染组件。
3.  **Boss Mode 增强**：目前的伪装仅是 UI 层级，建议增加防误触或快速唤回原界面的隐蔽手势。

---

## 3. 优化建议

### 🏗 架构优化
- **基类抽象**：目前存在大量的动作执行页（如 `ExerciseExecutionPage`、`BoneResetPage`、`WristRestructurePage`），逻辑和 UI 结构高度相似。建议抽象出 `BaseExercisePage`，通过配置协议数据来驱动，减少重复代码。
- **Provider 升级**：当前手动编写 `StateNotifier`，建议切换到 `riverpod_generator` 以获得更好的性能和简洁性。

### ⚡ 性能与 UX 优化
- **绘制性能**：`CustomPaint` 绘制的网格（`_BackgroundGridPainter`）在每个页面中重复创建。可以将其封装为单个 `RepaintBoundary` 或全局静态装饰，减少 build 开销。
- **动画流畅度**：部分高频执行的 `Timer.periodic` (10ms) 可能在低端机上产生压力。建议对进度计算使用 `AnimationController` 的微秒级触发，而不是 10ms 的定时器。

### 💾 工程化建议
- **多端适配**：目前的 UI 强依赖于固定比例的 Stack 布局，在不同尺寸屏幕（如平板或超窄屏）上可能存在溢出风险，需引入 `LayoutBuilder` 适配。
- **错误处理**：目前的路由跳转未加 guard，例如未经过诊断直接进入仪表盘的情况需要更鲁棒的处理。

---

## 4. 下一步行动建议

1.  **首要任务**：集成 Isar 持久化。确保用户数据不再丢失，这是“生存游戏”仪式感的根基。
2.  **核心突破**：将 Mock Timer 升级为基于加速度传感器的久坐监测算法。
3.  **重构试点**：重构 `ExerciseExecutionPage` 为模板驱动，方便快速新增动作包。
